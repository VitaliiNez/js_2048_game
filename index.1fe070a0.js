const t=new class{constructor(){this.initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.state=this.initialState.map(t=>[...t]),this.status="idle",this.score=0}moveLeft(){if("playing"!==this.getStatus())return;let t=this.state.map(t=>this.move(t));JSON.stringify(this.getState())!==JSON.stringify(t)&&(this.updateGameState(t),this.addCells())}moveRight(){if("playing"!==this.getStatus())return;let t=this.state.map(t=>[...t].reverse()).map(t=>this.move(t).reverse());JSON.stringify(this.getState())!==JSON.stringify(t)&&(this.updateGameState(t),this.addCells())}moveUp(){if("playing"!==this.getStatus())return;let t=this.rotateMatrixCounterClockwise(this.getState()).map(t=>this.move(t)),e=this.rotateMatrixClockwise(t);JSON.stringify(this.getState())!==JSON.stringify(e)&&(this.updateGameState(e),this.addCells())}moveDown(){if("playing"!==this.getStatus())return;let t=this.rotateMatrixClockwise(this.getState()).map(t=>this.move(t)),e=this.rotateMatrixCounterClockwise(t);JSON.stringify(this.getState())!==JSON.stringify(e)&&(this.updateGameState(e),this.addCells())}move(t){let e=[],s=0;for(;s<t.length;){let i=t[s];if(i){let a=!1;for(let r=s+1;r<t.length;r++){let l=t[r];if(l===i){e.push(2*i),this.updateGameScore(2*i),a=!0,s=r+1;break}if(l){e.push(i),a=!0,s=r;break}}!a&&(e.push(i),s++)}else s++}for(;e.length<t.length;)e.push(0);return e}rotateMatrixClockwise(t){let e=t.length,s=[];for(let i=0;i<e;i++){s.push([]);for(let a=0;a<e;a++)s[i].unshift(t[a][i])}return s}rotateMatrixCounterClockwise(t){let e=t.length,s=[];for(let t=0;t<e;t++)s.push([]);for(let i=0;i<e;i++)for(let a=0;a<e;a++)s[e-a-1].push(t[i][a]);return s}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status="playing",this.addCells(2)}restart(){this.status="idle",this.resetState()}getEmptyCells(){return this.state.flatMap((t,e)=>t.map((t,s)=>0===t?[e,s]:null)).filter(t=>null!==t)}createNewTile(){let t=this.getEmptyCells();if(!t.length)return;let[e,s]=t[Math.trunc(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}addCells(t=1){for(let e=0;e<t;e++)this.createNewTile();let e=this.getState();this.isWin(e)?this.status="win":this.isStateValid(e)||(this.status="lose")}resetState(){this.state=this.initialState.map(t=>[...t]),this.score=0}isStateValid(t){if("playing"!==this.status)return!1;for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)if(s<t[e].length-1&&t[e][s]===t[e][s+1]||e<t.length-1&&t[e][s]===t[e+1][s]||!t[e][s])return!0;return!1}updateGameState(t){this.state=t}updateGameScore(t){this.score+=t}isWin(t){return t.flat().some(t=>2048===t)}},e=document.querySelector(".button"),s=document.querySelector(".game-score"),i=[...document.querySelectorAll(".field-row")].map(t=>[...t.children]),a={idle:document.querySelector(".message-start"),lose:document.querySelector(".message-lose"),win:document.querySelector(".message-win")},r=t=>{t.forEach((t,e)=>{t.forEach((t,s)=>{let a=i[e][s];a.className=t?`field-cell field-cell--${t}`:"field-cell",a.textContent=t||""})})},l=()=>{let e=t.getStatus();for(let t in a)a[t].classList.toggle("hidden",t!==e)},n=t=>{s.textContent=t};e.addEventListener("click",s=>{"Start"===s.target.textContent?(t.start(),e.textContent="Restart",e.classList.remove("start"),e.classList.add("restart")):(t.restart(),n(0),e.textContent="Start",e.classList.remove("restart"),e.classList.add("start")),r(t.getState()),l()}),document.addEventListener("keydown",e=>{if(e.preventDefault(),"playing"!==t.getStatus())return;let s={ArrowUp:t.moveUp,ArrowDown:t.moveDown,ArrowLeft:t.moveLeft,ArrowRight:t.moveRight}[e.key];s&&s.call(t),r(t.getState()),n(t.getScore()),l()});
//# sourceMappingURL=index.1fe070a0.js.map
